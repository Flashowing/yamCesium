<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scene/camera/Camera.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scene/camera/Camera.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as Cesium from "cesium";
import Immersion from "./Immersion";
import HawkEyeMap from "./hawkEyeMap/HawkEyeMap";
// @ts-ignore
const Knockout = Cesium.knockout;
class Camera {
    constructor(viewer) {
        /**
         * 第一人称视角
         */
        this.immersion = null;
        /**
         * 鹰眼图
         * @param viewer
         */
        this.hawkEye = null;
        /**
         * 绕点旋转事件
         * @private
         */
        this.aroundClockEvent = null;
        if (!viewer) {
            throw Error("the constructor of Map need a parameter of type Cesium.Viewer");
        }
        this.viewer = viewer;
        this.immersion = new Immersion(viewer);
        this.hawkEye = new HawkEyeMap(viewer);
    }
    /**
     * 绕点旋转
     * @param position 绕点旋转的点
     * @param radius 旋转半径
     * @param duration 旋转时间
     * @param angle 旋转角度（速度）
     */
    flyAround(position, radius = 1000, duration = 3, angle = 0.005) {
        const curPosition = Cesium.Ellipsoid.WGS84.cartesianToCartographic(position);
        const lng = curPosition.longitude * 180 / Math.PI;
        const lat = curPosition.latitude * 180 / Math.PI;
        const boundingSphere = new Cesium.BoundingSphere(Cesium.Cartesian3.fromDegrees(lng, lat, 0), radius);
        let distance = Cesium.Cartesian3.distance(this.viewer.camera.position, position);
        distance = distance > radius ? radius : distance;
        const offset = new Cesium.HeadingPitchRange(this.viewer.camera.heading, this.viewer.camera.pitch, distance);
        this.viewer.camera.flyToBoundingSphere(boundingSphere, {
            offset: offset,
            duration: duration,
            complete: () => {
                const transform = Cesium.Transforms.eastNorthUpToFixedFrame(position);
                //相机位置初始化
                this.viewer.scene.camera.lookAtTransform(transform, new Cesium.HeadingPitchRange(this.viewer.camera.heading, this.viewer.camera.pitch, distance));
                // 定时任务
                this.aroundClockEvent = () => {
                    this.viewer.scene.camera.rotateRight(angle);
                };
                this.viewer.clock.onTick.addEventListener(this.aroundClockEvent);
            }
        });
        return this.aroundClockEvent;
    }
    /**
     * 停止绕点旋转
     */
    stopAround() {
        this.viewer.clock.onTick.removeEventListener(this.aroundClockEvent);
        this.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
        this.viewer.scene.screenSpaceCameraController.enableInputs = true;
    }
    look(lon, lat, offset) {
        if (!this.viewer) {
            return;
        }
        const center = Cesium.Cartesian3.fromDegrees(lon, lat);
        const transform = Cesium.Transforms.eastNorthUpToFixedFrame(center);
        const camera = this.viewer.camera;
        camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;
        camera.lookAtTransform(transform, new Cesium.Cartesian3(-offset, -offset, offset));
        setTimeout(function () {
            camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
        }, 100);
    }
    /**
     * 相机原地旋转
     */
    _cameraRotate() {
        let timeId;
        let handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);
        handler.setInputAction((event) => {
            // 返回一个ray和地球表面的一个交点的Cartesian3坐标。
            let ray = this.viewer.camera.getPickRay(event.position);
            if (!ray)
                return;
            let cartesian = this.viewer.scene.globe.pick(ray, this.viewer.scene);
            if (!cartesian)
                return;
            timeId &amp;&amp; clearInterval(timeId);
            timeId = setInterval(() => {
                this._rotateHeading();
            }, 30);
        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);
        handler.setInputAction((event) => {
            clearInterval(timeId);
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);
    }
    _rotateHeading() {
        // 相机的当前heading
        let heading = Cesium.Math.toDegrees(this.viewer.camera.heading);
        if (heading >= 360 || heading &lt;= -360)
            heading = 0;
        heading = heading + 0.25; //调节转动快慢
        let pitch = this.viewer.camera.pitch;
        let ellipsoid = this.viewer.scene.globe.ellipsoid; //获取椭球
        let cartographic = ellipsoid.cartesianToCartographic(this.viewer.camera.position);
        let lat = Cesium.Math.toDegrees(cartographic.latitude);
        let lng = Cesium.Math.toDegrees(cartographic.longitude);
        let distance = cartographic.height;
        this.viewer.scene.camera.setView({
            destination: Cesium.Cartesian3.fromDegrees(lng, lat, distance),
            orientation: {
                heading: Cesium.Math.toRadians(heading),
                pitch: pitch
                // endTransform: Cesium.Matrix4.IDENTITY
            }
        });
    }
}
export default Camera;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-viewerCesiumNavigationMixin.html">viewerCesiumNavigationMixin</a></li></ul><h3>Classes</h3><ul><li><a href="AmapImageryProvider.html">AmapImageryProvider</a></li><li><a href="AmapMercatorTilingScheme.html">AmapMercatorTilingScheme</a></li><li><a href="BaiduImageryProvider.html">BaiduImageryProvider</a></li><li><a href="BaiduMercatorTilingScheme.html">BaiduMercatorTilingScheme</a></li><li><a href="Canvas2Image.html">Canvas2Image</a></li><li><a href="CesiumNavigation.html">CesiumNavigation</a></li><li><a href="CesiumZh.html">CesiumZh</a></li><li><a href="ClusterUtil.html">ClusterUtil</a></li><li><a href="CoordTransform.html">CoordTransform</a></li><li><a href="Map.html">Map</a></li><li><a href="NavigationControl.html">NavigationControl</a></li><li><a href="PrimitiveCluster.html">PrimitiveCluster</a></li><li><a href="PublicMethod.html">PublicMethod</a></li><li><a href="ResetViewNavigationControl.html">ResetViewNavigationControl</a></li><li><a href="UserInterfaceControl.html">UserInterfaceControl</a></li><li><a href="ZoomOutNavigationControl.html">ZoomOutNavigationControl</a></li></ul><h3>Global</h3><ul><li><a href="global.html#EARTH_RADIUS">EARTH_RADIUS</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Mon Nov 14 2022 23:16:25 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
