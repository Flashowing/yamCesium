<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>初始化地球</title>
  <link rel="stylesheet"
    href="http://183.230.114.154:9010/map/staticResources/Cesium-1.85/Build/Cesium/Widgets/widgets.css" />
  <script type="text/javascript"
    src="http://183.230.114.154:9010/map/staticResources/Cesium-1.85/Build/Cesium/Cesium.js"></script>
  <style>
    html,
    body,
    #cesiumContainer {
      height: 100%;
      width: 100%;
      margin: 0;
    }

    #tool {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 100;
    }

  </style>
</head>

<body>
  <div id="cesiumContainer">
    <div id="tool">
      <button id="shortcut">截屏</button>
      <button id="immersion">第一视角</button>
    </div>
  </div>
  <script src="../dist/gy.cesium.min.js"></script>
  <script>
    Cesium.Ion.defaultAccessToken =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0YWJlYzNkNS0yY2M0LTQxZWQtOGZhNi05MjEzYmVmZGVkNTkiLCJpZCI6MzU1NTEsImlhdCI6MTYwNDYyNzY2NH0.JxhQQxEvJTrmeARILcywKaPoPEPjO1RlqL28CRjktx8";
    const viewer = new Cesium.Viewer("cesiumContainer", {
      animation: false,
      timeline: false,
      contextOptions: {
        webgl: {
          //通过canvas.toDataURL()实现截图需要将该项设置为true
          preserveDrawingBuffer: true
        }
      },
    });

    var Gy = new gyCesium.Gy(viewer);

    let options = {};
    options.defaultResetView = Cesium.Rectangle.fromDegrees(78.443464, 14.801562, 126.103033, 49.773957);
    //options.defaultResetView = new Cesium.Cartographic(Cesium.Math.toRadians(114), Cesium.Math.toRadians(33), 500);

    // 指北针
    options.enableCompass = true;
    // 缩放
    options.enableZoomControls = true;
    // 比例尺
    options.enableDistanceLegend = true;
    // 指南针外环
    options.enableCompassOuterRing = true;
    viewer.extend(Cesium.viewerCesiumNavigationMixin, options);

    document.querySelector("#shortcut").addEventListener("click", () => {
      // 获取canvas
      let canvas = viewer.scene.canvas;
      //只需要定义图片的宽度（高度计算得到）
      let imageWidth = window.innerWidth;
      //保存（下载）图片
      gyCesium.Canvas2Image.saveAsImage(canvas, imageWidth, imageWidth * canvas.height / canvas.width, 'png', "截图");
    })

    document.querySelector("#immersion").addEventListener("click", () => {
      Gy.camera.immersion.viewModel.enabled = !Gy.camera.immersion.viewModel.enabled;
    })

  </script>
</body>

</html>
